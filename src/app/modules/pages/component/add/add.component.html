<mat-card>
  <form (ngSubmit)="submitForm()" class="w-100">
    <mat-card-header class="form-header w-100">
      <mat-card-title class="main-title">New Deployment</mat-card-title>
    </mat-card-header>

    <mat-card-content class="p-4">
      <div class="d-flex justify-content-start gap-1 align-items-center mb-3">
        <mat-label class="me-2 fw-bold fs-5">Regions:</mat-label>
        <div class="d-flex flex-wrap gap-2">
          <mat-checkbox *ngFor="let region of regions; let r = index" [(ngModel)]="region.selected"
            [name]="'region_' + r" [id]="region.label" color="primary" class="region-checkbox">
            {{ region.label | uppercase }}
          </mat-checkbox>
        </div>
      </div>
      <!-- Deployment Options Section -->
      <div class="form-section">
        <div class="row row-cols-4">
          <div class="ps-3 mb-3" *ngFor="let field of deploymentFields; let i = index">
            <mat-checkbox [(ngModel)]="field.selected" [name]="'deploymentField_' + i" class="checkbox w-100"
              color="primary">
              {{ field.label | titlecase }}
            </mat-checkbox>
          </div>
        </div>
      </div>
      <!-- Configuration Section -->
      <div class="row">
        <div class="col-3" *ngIf="isBackendSelected">
          <!-- Lambda to Deploy Dropdown -->
          <mat-form-field class="w-100" appearance="outline">
            <mat-label>Lambda Functions</mat-label>
            <mat-select [(ngModel)]="selectedLambdas" name="selectedLambdas" multiple
              placeholder="Select lambda functions" required="{{isBackendSelected}}">
              <mat-select-trigger>
                <span *ngIf="selectedLambdas.length === 0">No lambdas selected</span>
                <span *ngIf="selectedLambdas.length === 1">{{selectedLambdas[0]}}</span>
                <span *ngIf="selectedLambdas.length > 1">
                  {{selectedLambdas.length}} lambdas selected
                </span>
              </mat-select-trigger>
              <mat-option *ngFor="let lambda of lambdaOptions" [value]="lambda">
                {{ lambda }}
              </mat-option>
              <mat-error *ngIf="selectedLambdas.length > 1">
                Please select at least one lambda function
              </mat-error>
            </mat-select>
          </mat-form-field>
        </div>
        <!-- Scripts Section -->
        <div class="col" *ngIf="isDatabaseSelected">
          <div class="d-flex justify-content-start gap-3 align-items-center">
            <h5>Scripts Configuration:</h5>
            <div class="d-flex gap-3">
              <mat-checkbox *ngFor="let script of scriptsOptions; let j = index" [(ngModel)]="scripts[script]"
                [name]="'script_' + j" [id]="'script_' + script" class="checkbox pe-5" color="primary">
                <div class="script-label">
                  <span class="script-name">{{ script | titlecase }}</span>
                </div>
              </mat-checkbox>
            </div>
          </div>
        </div>
      </div>

      <!-- Credentials -->
      <div class="mt-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Access Key ID</mat-label>
          <input matInput placeholder="Enter your AWS Access Key ID" [(ngModel)]="KeyId" name="keyId" required
            #keyIdInput="ngModel">
          <mat-icon matPrefix>vpn_key</mat-icon>
          <mat-error *ngIf="keyIdInput.invalid && keyIdInput.touched">
            Access Key ID is required
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Secret Access Key</mat-label>
          <input matInput [type]="hideSecretKey ? 'password' : 'text'" placeholder="Enter your AWS Secret Access Key"
            [(ngModel)]="SecretKey" name="secretKey" required #secretKeyInput="ngModel">
          <mat-icon matPrefix>security</mat-icon>
          <button mat-icon-button matSuffix (click)="hideSecretKey = !hideSecretKey" [attr.aria-label]="'Hide password'"
            [attr.aria-pressed]="hideSecretKey" type="button">
            <mat-icon>{{hideSecretKey ? 'visibility_off' : 'visibility'}}</mat-icon>
          </button>
          <mat-error *ngIf="secretKeyInput.invalid && secretKeyInput.touched">
            Secret Access Key is required
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Session Token</mat-label>
          <textarea matInput placeholder="Enter your AWS Session Token (optional)" [(ngModel)]="SessionToken"
            name="sessionToken" rows="2" #sessionTokenInput="ngModel"></textarea>
          <mat-icon matPrefix>token</mat-icon>
          <mat-error *ngIf="sessionTokenInput.invalid && sessionTokenInput.touched">
            Session Token is required
          </mat-error>
        </mat-form-field>
      </div>
    </mat-card-content>

    <!-- Action Buttons -->
    <div class="form-actions">
      <button mat-raised-button color="primary" type="submit" class="deploy-button" [disabled]="!isFormValid()">
        <mat-icon>rocket_launch</mat-icon>
        Deploy Now
      </button>
      <button mat-button type="button" class="reset-button" (click)="backbtn()">
        <mat-icon>cancel</mat-icon>
        Cancel
      </button>
    </div>
  </form>
</mat-card>
